{"ast":null,"code":"var _jsxFileName = \"/Users/zakariaalmardaee/csfolder/vintage-game-emulator/frontend/src/components/EmulatorComponent.js\",\n  _s = $RefreshSig$();\nimport React, { useRef, useEffect, forwardRef, useImperativeHandle } from 'react';\nimport { NES } from 'jsnes';\nimport { createAudioContext, createAudioScriptProcessor } from '../audio';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst EmulatorComponent = /*#__PURE__*/_s( /*#__PURE__*/forwardRef(_c = _s(({\n  romData\n}, ref) => {\n  _s();\n  const canvasRef = useRef(null);\n  const audioContextRef = useRef(null);\n  const audioScriptProcessorRef = useRef(null);\n  const nesRef = useRef(null);\n  useImperativeHandle(ref, () => ({\n    getGameState: () => nesRef.current && nesRef.current.saveState()\n  }));\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    const context = canvas.getContext('2d');\n    const nes = new NES({\n      onFrame: frameBuffer => {\n        const imageData = context.getImageData(0, 0, 256, 240);\n        for (let i = 0; i < frameBuffer.length; i++) {\n          imageData.data[i * 4] = frameBuffer[i] & 0xff;\n          imageData.data[i * 4 + 1] = frameBuffer[i] >> 8 & 0xff;\n          imageData.data[i * 4 + 2] = frameBuffer[i] >> 16 & 0xff;\n          imageData.data[i * 4 + 3] = 0xff;\n        }\n        context.putImageData(imageData, 0, 0);\n      },\n      onAudioSample: (left, right) => {\n        const scriptProcessor = audioScriptProcessorRef.current;\n        if (scriptProcessor) {\n          scriptProcessor.bufferLeft.push(left);\n          scriptProcessor.bufferRight.push(right);\n        }\n      }\n    });\n    const audioContext = createAudioContext();\n    const scriptProcessor = createAudioScriptProcessor(audioContext);\n    scriptProcessor.connect(audioContext.destination);\n    audioContextRef.current = audioContext;\n    audioScriptProcessorRef.current = scriptProcessor;\n    nes.loadROM(romData);\n    nesRef.current = nes;\n    const runEmulator = () => {\n      nes.frame();\n      requestAnimationFrame(runEmulator);\n    };\n    runEmulator();\n    return () => {\n      if (audioContext) {\n        audioContext.close();\n      }\n    };\n  }, [romData]);\n  return /*#__PURE__*/_jsxDEV(\"canvas\", {\n    ref: canvasRef,\n    width: \"256\",\n    height: \"240\",\n    style: {\n      width: '100%',\n      height: 'auto'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 62,\n    columnNumber: 5\n  }, this);\n}, \"SB22w3R0Dzm1o5rZ1YwjmpG2BX0=\")), \"SB22w3R0Dzm1o5rZ1YwjmpG2BX0=\");\n_c2 = EmulatorComponent;\nexport default EmulatorComponent;\nvar _c, _c2;\n$RefreshReg$(_c, \"EmulatorComponent$forwardRef\");\n$RefreshReg$(_c2, \"EmulatorComponent\");","map":{"version":3,"names":["React","useRef","useEffect","forwardRef","useImperativeHandle","NES","createAudioContext","createAudioScriptProcessor","jsxDEV","_jsxDEV","EmulatorComponent","_s","_c","romData","ref","canvasRef","audioContextRef","audioScriptProcessorRef","nesRef","getGameState","current","saveState","canvas","context","getContext","nes","onFrame","frameBuffer","imageData","getImageData","i","length","data","putImageData","onAudioSample","left","right","scriptProcessor","bufferLeft","push","bufferRight","audioContext","connect","destination","loadROM","runEmulator","frame","requestAnimationFrame","close","width","height","style","fileName","_jsxFileName","lineNumber","columnNumber","_c2","$RefreshReg$"],"sources":["/Users/zakariaalmardaee/csfolder/vintage-game-emulator/frontend/src/components/EmulatorComponent.js"],"sourcesContent":["import React, { useRef, useEffect, forwardRef, useImperativeHandle } from 'react';\nimport { NES } from 'jsnes';\nimport { createAudioContext, createAudioScriptProcessor } from '../audio';\n\nconst EmulatorComponent = forwardRef(({ romData }, ref) => {\n  const canvasRef = useRef(null);\n  const audioContextRef = useRef(null);\n  const audioScriptProcessorRef = useRef(null);\n  const nesRef = useRef(null);\n\n  useImperativeHandle(ref, () => ({\n    getGameState: () => nesRef.current && nesRef.current.saveState(),\n  }));\n\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    const context = canvas.getContext('2d');\n\n    const nes = new NES({\n      onFrame: (frameBuffer) => {\n        const imageData = context.getImageData(0, 0, 256, 240);\n        for (let i = 0; i < frameBuffer.length; i++) {\n          imageData.data[i * 4] = frameBuffer[i] & 0xff;\n          imageData.data[i * 4 + 1] = (frameBuffer[i] >> 8) & 0xff;\n          imageData.data[i * 4 + 2] = (frameBuffer[i] >> 16) & 0xff;\n          imageData.data[i * 4 + 3] = 0xff;\n        }\n        context.putImageData(imageData, 0, 0);\n      },\n      onAudioSample: (left, right) => {\n        const scriptProcessor = audioScriptProcessorRef.current;\n        if (scriptProcessor) {\n          scriptProcessor.bufferLeft.push(left);\n          scriptProcessor.bufferRight.push(right);\n        }\n      },\n    });\n\n    const audioContext = createAudioContext();\n    const scriptProcessor = createAudioScriptProcessor(audioContext);\n    scriptProcessor.connect(audioContext.destination);\n    audioContextRef.current = audioContext;\n    audioScriptProcessorRef.current = scriptProcessor;\n\n    nes.loadROM(romData);\n    nesRef.current = nes;\n\n    const runEmulator = () => {\n      nes.frame();\n      requestAnimationFrame(runEmulator);\n    };\n    runEmulator();\n\n    return () => {\n      if (audioContext) {\n        audioContext.close();\n      }\n    };\n  }, [romData]);\n\n  return (\n    <canvas ref={canvasRef} width=\"256\" height=\"240\" style={{ width: '100%', height: 'auto' }} />\n  );\n});\n\nexport default EmulatorComponent;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}